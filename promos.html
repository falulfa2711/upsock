<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Up ×¡×˜×•×§ | ××‘×¦×¢×™× ×—××™×</title>
    <style>
        :root { 
            --primary: #ed1c24; 
            --secondary: #ffcc00; 
            --bg: #f4f4f4;
        }
        
        body { 
            font-family: system-ui, -apple-system, sans-serif; 
            background: var(--bg); 
            margin: 0; 
            padding-top: 70px; 
            direction: rtl; 
        }

        /* ×¡×¨×’×œ ×¢×œ×™×•×Ÿ ×§×‘×•×¢ */
        .header {
            position: fixed; top: 0; left: 0; right: 0;
            height: 60px; background: white;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .logo { font-weight: 900; color: var(--primary); font-size: 1.5em; text-decoration: none; }

        .cart-box {
            background: var(--primary); color: white;
            padding: 7px 15px; border-radius: 50px;
            font-weight: bold; font-size: 0.9em;
            display: flex; align-items: center; gap: 8px;
        }

        .container { max-width: 1100px; margin: auto; padding: 15px; }

        .promo-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); 
            gap: 15px; 
        }

        .card {
            background: white; border-radius: 15px; padding: 12px;
            text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            display: flex; flex-direction: column; justify-content: space-between;
            transition: transform 0.2s; border: 1px solid #eee;
        }

        .card:active { transform: scale(0.98); }

        .img-container {
            width: 100%; height: 120px;
            background: #f9f9f9; border-radius: 10px;
            margin-bottom: 10px; display: flex; align-items: center; justify-content: center;
            overflow: hidden;
        }

        .img-container img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .no-img { color: #ccc; font-size: 2em; }

        .badge {
            background: var(--secondary); color: black;
            font-weight: 800; padding: 5px; border-radius: 5px;
            font-size: 1em; margin-bottom: 8px; border: 1px solid #000;
        }

        .name { font-size: 0.95em; font-weight: 600; color: #333; margin-bottom: 12px; height: 38px; overflow: hidden; }

        .btn-add {
            background: var(--primary); color: white; border: none;
            padding: 10px; border-radius: 10px; font-weight: bold;
            cursor: pointer; width: 100%; font-size: 0.9em;
        }

        .back-link {
            display: inline-block; margin-bottom: 15px; color: #666;
            text-decoration: none; font-size: 0.9em;
        }
    </style>
</head>
<body>

<div class="header">
    <a href="index.html" class="logo">Up ×¡×˜×•×§</a>
    <div class="cart-box">
        ğŸ›’ ×¡×”"×› ×‘×¡×œ: <span id="cart-count">0</span>
    </div>
</div>

<div class="container">
    <a href="index.html" class="back-link">â†’ ×—×–×•×¨ ×œ×—× ×•×ª</a>
    <div id="promo-list" class="promo-grid">×˜×•×¢×Ÿ ××‘×¦×¢×™×...</div>
</div>

<script>
    // 1. ×¤×•× ×§×¦×™×™×ª ×¡× ×›×¨×•×Ÿ ×”×¢×’×œ×”
    function updateCartCounter() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const countElement = document.getElementById('cart-count');
        if (countElement) countElement.innerText = cart.length;
    }

    // 2. ×¤×•× ×§×¦×™×™×ª ×”×•×¡×¤×” ×œ×¡×œ (××¡×•× ×›×¨× ×ª ×œ-index.html)
    function addToCart(name, promo) {
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        cart.push({ name: name, price: promo });
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartCounter();
        
        // ××¤×§×˜ ×§×˜×Ÿ ×‘×›×¤×ª×•×¨ ×›×“×™ ×œ×”×¨××•×ª ×©×–×” ×¢×‘×“
        // (××•×¤×¦×™×•× ×œ×™: alert("×”×ª×•×•×¡×£ ×œ×¡×œ!"))
    }

    // 3. ×˜×¢×™× ×ª ×”××‘×¦×¢×™× ××”-CSV
    async function loadPromos() {
        try {
            const res = await fetch('stock_promos.csv?t=' + Date.now());
            const data = await res.text();
            const rows = data.split(/\r?\n/).slice(1); // ××“×œ×’ ×¢×œ ×”×›×•×ª×¨×ª
            const grid = document.getElementById('promo-list');
            grid.innerHTML = '';

            rows.forEach(row => {
                if (!row.trim()) return;
                const [name, promo, img] = row.split(',');

                const imgHtml = img && img.trim() ? 
                    `<img src="${img.trim()}" onerror="this.parentElement.innerHTML='<span class=\'no-img\'>ğŸ“·</span>'">` : 
                    `<span class="no-img">ğŸ“·</span>`;

                grid.innerHTML += `
                    <div class="card">
                        <div class="img-container">${imgHtml}</div>
                        <div class="badge">${promo}</div>
                        <div class="name">${name}</div>
                        <button class="btn-add" onclick="addToCart('${name}', '${promo}')">×”×•×¡×¤×” ×œ×¡×œ</button>
                    </div>
                `;
            });
        } catch (err) {
            console.error("×©×’×™××” ×‘×˜×¢×™× ×ª CSV:", err);
            document.getElementById('promo-list').innerHTML = "×©×’×™××” ×‘×˜×¢×™× ×ª ×”××‘×¦×¢×™×.";
        }
    }

    // ×”×¤×¢×œ×” ×¨××©×•× ×™×ª
    window.addEventListener('DOMContentLoaded', () => {
        loadPromos();
        updateCartCounter();
    });

    // ×”××–× ×” ×œ×©×™× ×•×™×™× ×‘-Storage (×× ×”×“×£ ×¤×ª×•×— ×‘×©×ª×™ ×œ×©×•× ×™×•×ª)
    window.addEventListener('storage', updateCartCounter);
</script>

</body>
</html>
