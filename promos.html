
<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מבצעים - Up סטוק</title>
    <style>
        /* ===== סטייל ייחודי לדף מבצעים בלבד ===== */
        body { text-align: center; }
        h1 { color: var(--dark); margin-top: 30px; }
        .products-container { display: grid !important; grid-template-columns: repeat(4, 1fr) !important; gap: 10px; padding: 10px; max-width: 100%; box-sizing: border-box; }
        @media (max-width: 600px) { .products-container { grid-template-columns: repeat(2, 1fr) !important; } }
        .product-card { background: white; border-radius: 12px; padding: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); display: flex; flex-direction: column; justify-content: space-between; min-width: 0; }
        .product-card img { width: 100%; height: 100px; object-fit: contain; border-radius: 8px; cursor: pointer; }
        .product-card h4 { margin: 10px 0 5px; font-size: 0.9em; color: var(--dark); height: 2.4em; overflow: hidden; }
        .price { color: var(--primary); font-weight: bold; font-size: 1.1em; margin-bottom: 10px; }
        .add-btn { background: var(--primary); color: white; border: none; padding: 10px; border-radius: 8px; cursor: pointer; width: 100%; font-weight: bold; font-size: 0.9em; }
        /* אוברליי תמונה */
        #imageModal { display: none; position: fixed; z-index: 5000; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); justify-content: center; align-items: center; }
        #imageModal img { max-width: 90%; max-height: 85%; border-radius: 10px; }
    </style>
    <script src="common.js" defer></script>
</head>
<body>

    <h1>מבצעי החנות</h1>
    <div id="promos-container" class="products-container"></div>

    <div id="imageModal" onclick="closeModal()">
        <img id="imgFull" src="">
    </div>

    <script>
        async function loadPromos() {
            try {
                const response = await fetch('stock_promos.csv?t=' + Date.now());
                const data = await response.text();
                const rows = data.split('\n').slice(1);
                const container = document.getElementById('promos-container');
                container.innerHTML = "";
                rows.forEach(row => {
                    if (!row.trim()) return;
                    const cols = row.split(',');
                    if (cols.length >= 3) {
                        const name   = cols[0].trim();
                        const promo  = cols[1].trim();
                        const imgSrc = cols[2].trim();
                        container.innerHTML +=
                            '<div class="product-card">' +
                            '<img src="' + imgSrc + '" onclick="openModal(\'' + imgSrc + '\')" onerror="this.src=\'images/logo.jpg\'">' +
                            '<h4>' + name + '</h4>' +
                            '<div class="price">' + promo + '</div>' +
                            '<button class="add-btn" onclick="addToCart(\'' + name.replace(/'/g, "\\'") + '\', \'' + promo + '\')">הוסף לסל +</button>' +
                            '</div>';
                    }
                });
            } catch (e) { console.error("Error loading Promos CSV", e); }
        }

        function openModal(src) { document.getElementById('imageModal').style.display = "flex"; document.getElementById('imgFull').src = src; }
        function closeModal()   { document.getElementById('imageModal').style.display = "none"; }

        document.addEventListener('DOMContentLoaded', loadPromos);
    </script>

</body>
</html>
